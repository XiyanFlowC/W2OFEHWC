<!DOCTYPE html>
<html>
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>管理员登录</title>
    <link rel="stylesheet" type="text/css" href="./css/bootstrap.css" />
    <link rel="stylesheet" type="text/css" href="./css/site.css" />
    <script src="./js/jquery-3.5.1.min.js"></script>
    <script src="./js/bootstrap.min.js"></script>
    <script src="./js/vue.min.js"></script>
</head>
<body>
    <div id="login" class="container">
        <div class="alert alert-danger" v-if="alertmsg != ''">{{alertmsg}}</div>
        <form id="login-form" class="form-signin">
            <h1>{{gname}}</h1>
            <h2 class="form-signin-heading">管理员登入</h2>
            <input v-model="accound" type="text" id="accoundInput" class="form-control" placeholder="账户" required autofocus/>
            <input v-model="passwd" type="password" id="pswdInput" class="form-control" placeholder="密码" required />
            <button class="btn btn-lg btn-primary btn-block" type="button" @click="login">登入</button>
        </form>
    </div>
    <script>
        var appname = "大大网盘";
        var apirt = "http://39.105.228.56:8080/disk"//"http://3724777y08.oicp.vip/disk"//

        var vapp = new Vue({
            el : "#login",
            data : {
                gname : appname,
                passwd : "",
                accound: "",
                alertmsg : ""
            },
            methods:{
                login : function() {
                    if(this.accound == "" || this.passwd == "") {
                        this.alertmsg = "用户名和密码不能为空"
                        return;
                    }
                    $.post(apirt + "/admin/login",
                    {
                        adminAccount : this.accound,
                        adminPassword : this.passwd
                    },
                    (data, status, jqXHR) =>
                    {
                        if(jqXHR.status == 200)
                        {// OK
                            if(data.code == -1)
                            {
                                this.alertmsg = data.msg
                            }
                            else if(data.code == 1)
                            {
                                localStorage.setItem("usrNo", data.obj.adminBean.adminNo);
                                localStorage.setItem('usrName', data.obj.adminBean.adminName)
                                localStorage.setItem("token", data.obj.token);
                                top.location = './admin.htm'
                            }
                            else
                            {
                                this.alertmsg = "接口返回结果违反规范"
                            }
                        }
                        if(jqXHR.status == 403)
                        {
                            this.alertmsg = "登入请求被拒绝"
                        }
                        if(jqXHR.status == 404)
                        {
                            this.alertmsg = "服务器离线或资源丢失"
                        }
                        if(jqXHR.status == 402)
                        {
                            this.alertmsg = "需要付费以登入"
                        }
                        if(jqXHR.status == 401)
                        {
                            this.alertmsg = "需要授权以登入"
                        }
                    })
                    .fail(function(xhr, status, err)
                    {
                        if(status == "timeout") alertmsg = "服务器响应超时"
                        if(status == "parseerror") alertmsg = "数据错误"
                        if(status == "error") alertmsg = err
                    })
                }
            }
        });
    </script>
</body>
</html>